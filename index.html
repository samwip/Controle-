<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-select=none">
    <title>Gamepad Overlay Custom</title>
    <style>
        /* Garantindo transparência total para o OBS/TikTok Studio */
        html, body { 
            background: transparent !important; 
            margin: 0; 
            padding: 0;
            overflow: hidden; 
            font-family: sans-serif; 
            user-select: none; 
            width: 100vw; 
            height: 100vh; 
        }
        
        #edit-menu {
            position: fixed; top: -60px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 15px; background: rgba(0,0,0,0.9); padding: 10px 20px;
            border-radius: 0 0 15px 15px; border: 1px solid #00a2ff; z-index: 1000;
            transition: top 0.3s ease;
        }
        #edit-menu.show { top: 0; }
        .menu-btn { padding: 8px 15px; border: none; border-radius: 5px; color: white; font-weight: bold; cursor: pointer; }
        .save-btn { background: #28a745; }
        .reset-btn { background: #dc3545; }

        #lock-btn {
            position: fixed; top: 10px; left: 50%; transform: translateX(-50%);
            z-index: 1001; opacity: 0; cursor: pointer; width: 40px; height: 20px;
        }

        .group { position: absolute; touch-action: none; display: flex; align-items: center; justify-content: center; z-index: 20; }
        .btn-core {
            display: flex; align-items: center; justify-content: center;
            background: rgba(0, 0, 0, 0.4); border: 2px solid rgba(255, 255, 255, 0.5);
            font-weight: bold; border-radius: 50%; width: 60px; height: 60px;
            transition: background 0.1s, transform 0.05s;
        }
        .dpad-grid, .action-grid { display: grid; grid-template-areas: ". up ." "left . right" ". down ."; gap: 10px; }
        .rect { border-radius: 8px; width: 70px; height: 35px; font-size: 11px; position: absolute; background: rgba(0, 0, 0, 0.4); border: 2px solid rgba(255, 255, 255, 0.5); display: flex; align-items: center; justify-content: center; }
        
        /* Estilo quando o botão é pressionado */
        .active { 
            background: rgba(0, 162, 255, 0.9) !important; 
            border-color: #00f2ff !important; 
            box-shadow: 0 0 20px #0096ff;
            transform: scale(1.1);
        }

        .stick-area { width: 100px; height: 100px; border: 2px dashed rgba(255,255,255,0.2); border-radius: 50%; position: absolute; display: flex; align-items: center; justify-content: center; background: rgba(0, 0, 0, 0.2); }
        .stick { width: 40px; height: 40px; background: rgba(255,255,255,0.3); border: 2px solid rgba(255,255,255,0.6); border-radius: 50%; pointer-events: none; position: absolute; }
    </style>
</head>
<body>

<div id="lock-btn" onclick="toggleLock()"></div>

<div id="edit-menu">
    <button class="menu-btn save-btn" onclick="confirmSave()">SALVAR</button>
    <button class="menu-btn reset-btn" onclick="resetLayout()">RESETAR</button>
</div>

<div id="group-dpad" class="group dpad-grid" style="left: 10%; top: 30%;">
    <div id="btn-12" class="btn-core" style="grid-area: up;">↑</div>
    <div id="btn-14" class="btn-core" style="grid-area: left;">←</div>
    <div id="btn-15" class="btn-core" style="grid-area: right;">→</div>
    <div id="btn-13" class="btn-core" style="grid-area: down;">↓</div>
</div>

<div id="group-actions" class="group action-grid" style="right: 10%; top: 30%;">
    <div id="btn-3" class="btn-core" style="grid-area: up;">Δ</div>
    <div id="btn-2" class="btn-core" style="grid-area: left;">□</div>
    <div id="btn-1" class="btn-core" style="grid-area: right;">○</div>
    <div id="btn-0" class="btn-core" style="grid-area: down;">×</div>
</div>

<div id="btn-6" class="group rect" style="left: 5%; top: 5%;">L2</div>
<div id="btn-4" class="group rect" style="left: 5%; top: 15%;">L1</div>
<div id="btn-7" class="group rect" style="right: 5%; top: 5%;">R2</div>
<div id="btn-5" class="group rect" style="right: 5%; top: 15%;">R1</div>
<div id="btn-8" class="group rect" style="left: 35%; bottom: 20px;">SHARE</div>
<div id="btn-16" class="group btn-core" style="left: 47%; bottom: 20px; border-color: orange; width: 45px; height: 45px;">PS</div>
<div id="btn-9" class="group rect" style="left: 58%; bottom: 20px;">OPT</div>

<div id="stick-area-0" class="group stick-area" style="left: 10%; bottom: 15%;"><div id="stick-0" class="stick"></div></div>
<div id="stick-area-1" class="group stick-area" style="right: 10%; bottom: 15%;"><div id="stick-1" class="stick"></div></div>

<script>
    const groups = document.querySelectorAll('.group');
    const menu = document.getElementById('edit-menu');
    let isLocked = true; 

    function toggleLock() {
        isLocked = !isLocked;
        if (!isLocked) menu.classList.add('show');
        else menu.classList.remove('show');
    }

    window.onload = () => {
        groups.forEach(el => {
            const saved = localStorage.getItem(el.id);
            if (saved) {
                const config = JSON.parse(saved);
                el.style.left = config.left;
                el.style.top = config.top;
                el.style.transform = `scale(${config.scale || 1})`;
                el.dataset.scale = config.scale || 1;
            }
        });
        // Inicia o loop de verificação imediatamente
        requestAnimationFrame(update);
    };

    function confirmSave() {
        groups.forEach(el => {
            localStorage.setItem(el.id, JSON.stringify({
                left: el.style.left,
                top: el.style.top,
                scale: el.dataset.scale || 1
            }));
        });
        isLocked = true;
        menu.classList.remove('show');
    }

    function resetLayout() {
        localStorage.clear();
        location.reload();
    }

    // Lógica de Arrastar (Drag and Drop)
    groups.forEach(el => {
        let isDragging = false;
        el.onpointerdown = (e) => {
            if (isLocked) return; 
            isDragging = true;
            el.setPointerCapture(e.pointerId);
        };
        el.onpointermove = (e) => {
            if (!isDragging || isLocked) return;
            el.style.left = (el.offsetLeft + e.movementX) + 'px';
            el.style.top = (el.offsetTop + e.movementY) + 'px';
            el.style.right = 'auto'; el.style.bottom = 'auto';
        };
        el.onpointerup = () => isDragging = false;

        el.addEventListener('dblclick', () => {
            if (isLocked) return;
            let s = parseFloat(el.dataset.scale || 1);
            s = s >= 2 ? 0.6 : s + 0.2;
            el.dataset.scale = s;
            el.style.transform = `scale(${s})`;
        });
    });

    // FUNÇÃO DE ATUALIZAÇÃO (CORE)
    function update() {
        // navigator.getGamepads() precisa ser chamado a cada frame em alguns navegadores
        const gps = navigator.getGamepads();
        const gp = gps[0] || gps[1] || gps[2] || gps[3]; // Pega o primeiro controle ativo

        if (gp) {
            // Atualiza botões
            gp.buttons.forEach((btn, i) => {
                const el = document.getElementById(`btn-${i}`);
                if (el) {
                    if (btn.pressed || btn.value > 0.1) {
                        el.classList.add('active');
                    } else {
                        el.classList.remove('active');
                    }
                }
            });

            // Atualiza Analógicos com Deadzone de 0.1 para evitar trepidação
            updateStick('stick-0', gp.axes[0], gp.axes[1]); 
            updateStick('stick-1', gp.axes[2], gp.axes[3]);
        }
        
        requestAnimationFrame(update);
    }

    function updateStick(id, x, y) {
        const stick = document.getElementById(id);
        if (stick) {
            const threshold = 0.1;
            const posX = Math.abs(x) > threshold ? x * 30 : 0;
            const posY = Math.abs(y) > threshold ? y * 30 : 0;
            stick.style.transform = `translate(${posX}px, ${posY}px)`;
            
            // Ativa brilho se o analógico for movido
            if (Math.abs(x) > threshold || Math.abs(y) > threshold) {
                stick.style.borderColor = "#00f2ff";
                stick.style.background = "rgba(0, 162, 255, 0.5)";
            } else {
                stick.style.borderColor = "rgba(255,255,255,0.6)";
                stick.style.background = "rgba(255,255,255,0.3)";
            }
        }
    }
</script>
</body>
                                                                    </html>
                                                                    
